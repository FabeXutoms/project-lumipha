// Prisma Schema - PostgreSQL için optimize edilmiş
// Dokümantasyon: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Müşteri modeli
model Client {
  id                   Int       @id @default(autoincrement())
  name                 String    @db.VarChar(255)
  email                String    @unique @db.VarChar(255)
  otpCode              String?   @map("otp_code")
  otpExpiresAt         DateTime? @map("otp_expires_at") @db.Timestamptz
  previousOtpCode      String?   @map("previous_otp_code")
  previousOtpExpiresAt DateTime? @map("previous_otp_expires_at") @db.Timestamptz
  phone                String?   @db.VarChar(50)
  createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // İlişkiler
  projectActions ProjectAction[]

  @@map("clients")
}

// Proje hareketleri modeli
model ProjectAction {
  id               Int       @id @default(autoincrement())
  clientId         Int       @map("client_id")
  trackingCode     String    @unique @db.VarChar(20) @map("tracking_code")
  packageName      String    @db.VarChar(255) @map("package_name")
  totalAmount      Decimal   @db.Decimal(10, 2) @map("total_amount")
  status           Status    @default(Pending)
  startDate        DateTime  @db.Date @map("start_date")
  estimatedEndDate DateTime? @db.Date @map("estimated_end_date")
  companyName      String?   @map("company_name") @db.Text
  businessType     String?   @map("business_type") @db.Text
  businessScale    String?   @map("business_scale") @db.Text
  projectLink      String?   @map("project_link") @db.Text

  // İlişkiler
  client   Client    @relation(fields: [clientId], references: [id])
  payments Payment[]

  @@map("project_actions")
}

// Ödeme modeli
model Payment {
  id              Int       @id @default(autoincrement())
  projectActionId Int       @map("project_action_id")
  amount          Decimal   @db.Decimal(10, 2)
  paymentDate     DateTime  @default(now()) @map("payment_date") @db.Timestamptz
  paymentMethod   String?   @db.VarChar(100) @map("payment_method")
  transactionId   String    @unique @db.VarChar(255) @map("transaction_id")

  // İlişkiler
  projectAction ProjectAction @relation(fields: [projectActionId], references: [id])

  @@map("payments")
}

// Proje durumları - PostgreSQL yerel ENUM tipi
enum Status {
  WaitingForApproval @map("Onay Bekliyor")
  Pending            @map("Beklemede")
  InProgress         @map("Devam Ediyor")
  Completed          @map("Tamamlandı")
  Cancelled          @map("İptal Edildi")

  @@map("project_status")
}

// İletişim formu mesajları modeli
model ContactMessage {
  id        Int      @id @default(autoincrement())
  fullName  String   @db.VarChar(255) @map("full_name")
  email     String   @db.VarChar(255)
  phone     String   @db.VarChar(50)
  message   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  isRead    Boolean  @default(false) @map("is_read")

  @@map("contact_messages")
}